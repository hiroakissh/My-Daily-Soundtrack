# My Daily Soundtrack — PH1 実装仕様（既存機能）

## 目的
GPS に連動したシンプルなサウンドスケープ体験を提供し、ユーザーがいる場所に合わせて環境音・音楽のトーンを変化させる。PH2 以降の拡張（時間/天気/モーション/オープニング演出）に備えて、プロトコル設計とフォルダ構成を整えておく。

## コア機能
- 位置情報から簡易 `GeoTag` を推定し、タグごとにサウンドスケープを切り替える。
- 常時再生する環境音（Pad/FieldNoise/FX の簡易レイヤー）を場所に応じて選択。
- フルスクリーン UI（最小限の再生/停止操作、現在のタグ表示）。
- 背景オーディオ対応、バックグラウンド位置更新に対応。

## データモデル
```swift
enum GeoTag {
  case station
  case park
  case cafe
  case river
  case forest
  case urban
}
```

## 位置タグ推定
- CoreLocation の位置座標を簡易ジオフェンスに照合し、最初にマッチしたタグを採用。
- 解像度は粗くし、精緻な地形判定は行わない（PH2 でも同タグを再利用）。
- 一定のドリフトを許容するため、数秒のヒステリシスを設けてタグ変更を抑制。

## オーディオ挙動
- シーン概念は持たず、`GeoTag` に紐づくプリセットを使用。
- レイヤー（シンプル版）: `pad`, `fx`, `fieldNoise`。
- タグ変更時は 1–2 秒のクロスフェードで遷移し、曲の切断は行わない。
- BPM 同期は不要、環境音主体で静的バランス。

## UI
- フルスクリーンで最小情報量。
- 小さなタグ表示、再生インジケータ、再生/停止ボタンのみ。
- デバッグ用オーバーレイ（開発ビルドのみ）で現在の位置・タグを表示可能にする。

## アーキテクチャ（PH1 簡易版）
- **Presentation (SwiftUI)**: View とシンプルな ViewModel。
- **ViewModel**: 現在の `GeoTag` と再生状態を公開。DI を前提にプロトコル参照。
- **GeoTagProvider**: CoreLocation をラップし、タグを算出して publish。
- **AudioRenderer**: タグごとのプリセットを適用し、レイヤー音源をクロスフェード。
- **DI/Infrastructure**: Provider と Renderer を差し替え可能にする（モック用実装を用意）。

## 更新ポリシー
- 位置更新はシステムの Significant Location Change または一定距離移動でトリガー。
- タグ変更時のみオーディオを更新（ポーリングは不要）。

## テスト
- GeoTagProvider: 位置座標 → タグ判定のユニットテスト（代表地点のフィクスチャ）。
- AudioRenderer: タグ変更時にフェードが実行されることをユニットテストまたはスナップショットで確認。
- UI プレビュー: モック Provider を使い、タグ切替の見え方を確認。

## PH2 以降への布石
- モデル（`GeoTag`）とプロトコルの命名を PH2 の `ContextAggregator` / `SceneClassifier` と整合させる。
- フォルダ構成は PH2 推奨のまま使用し、PH1 では未使用のプロバイダはスタブにしておく。
