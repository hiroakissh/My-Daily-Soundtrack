# 画面仕様: デバッグオーバーレイ（PH1）

## メタ情報
- 画面名: デバッグオーバーレイ
- バージョン/更新日: 1.0 / 2024-XX-XX
- 作成者/レビュー担当:
- 対応フェーズ: PH1（開発ビルド限定）

## 目的と役割
- 開発/検証時にコンテキストと再生状態を即座に確認し、Scene 判定や GeoTag 変更をデバッグする。
- 本番ビルドでは無効化。

## ユーザーフロー
- シナリオ: メイン画面で 3 本指タップなどの隠し操作 → オーバーレイ表示/非表示。
- 前提: Debug/QA フラグが有効。
- 終了条件: 再度トグルで閉じる。

## レイアウト概要
- メイン画面にオーバーレイ表示。右上に閉じるボタン。
- セクション/コンポーネント:
  - ヘッダー: タイトル、閉じるアイコン。
  - コンテキスト表示: GeoTag, TimeBand, Weather, Motion。
  - Scene 判定: 現在 SceneID、判定信頼度やロック残り時間。
  - Playback: 状態、現在プリセット名、ボリューム/レイヤー。
  - アクション: Mock 切替、強制 GeoTag/Scene 設定（開発のみ）。
- 寸法表（目安）:

| 要素 | サイズ(pt) | 余白(pt) | 備考 |
| ---- | ----------- | -------- | ---- |
| パネル | 幅 90% | 上 24 | 角丸 16、半透明 |
| 行 | 高さ 24–32 | 縦 8 | ラベル+値 |

## コンポーネント詳細
- ヘッダー
  - 役割: オーバーレイタイトルと閉じる操作。
- コンテキスト行
  - バインド: `ContextStore.snapshot`（GeoTag/TimeBand/Weather/Motion）。
  - 表示形式: `GeoTag: urban`, `Cadence: 102 spm` など。
- Scene セクション
  - バインド: `SceneStore.state`（current, candidate, lockRemaining）。
  - 追加表示: 判定スコア（ルールマッチ件数など）。
- Playback セクション
  - バインド: `PlaybackStore.state`, `ScorePlan` の主要パラメータ。
  - レイヤー表示: pad/arp/beat/fx/fieldNoise のレベルをバー表示。
- アクション
  - Mock 切替: テスト用の固定 Context を選択。
  - 強制 Scene/GeoTag: 開発用のみ。StateObservationKit の書き込みが可能な安全なパスに限定。

## データ・状態（StateObservationKit / ステートマシン）
- ステートマシン: `DebugOverlayStore.state`
  - 状態: hidden → showing → hidden
  - トリガー: 隠しジェスチャ or Debug メニュー。
  - 副作用: なし（表示のみ）。強制操作は明示的ボタンに限定。
- 購読ストア: `ContextStore`, `SceneStore`, `PlaybackStore`, `ScorePlanStore`。
- ローカル状態: トグルフラグ、モック選択値。
- 状態遷移表（例）:

| 現在 | イベント/条件 | 遷移先 | 副作用 |
| ---- | ------------- | ------ | ------ |
| hidden | 3本指タップ | showing | オーバーレイ表示 |
| showing | 3本指タップ or 閉じる | hidden | 非表示 |

## アニメーション・モーション
- フェードイン/アウト (180ms)。
- パネルのスライドアップ (12pt)。

## サウンド挙動
- なし（表示のみ）。

## 空状態・エラー状態
- ストア未接続時は「データなし」と表示。

## 権限・デバイス前提
- 開発ビルドのみ有効。リリースビルドではコンパイル除外。

## 計測・ログ（任意）
- なし（開発用）。必要ならデバッグイベントとして記録。

## 未決事項・メモ
- 表示トリガーの最終決定（シェイク/3本指タップ/長押し）。
- 強制書き込みアクションの制限範囲を決める。
