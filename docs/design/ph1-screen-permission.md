# 画面仕様: 位置情報許可ガイド（PH1）

## メタ情報
- 画面名: 位置情報許可ガイド
- バージョン/更新日: 1.0 / 2024-XX-XX
- 作成者/レビュー担当: 
- 対応フェーズ: PH1

## 目的と役割
- 位置情報とバックグラウンドオーディオが必要な理由を示し、ユーザーに権限を付与してもらう。
- 許可されない場合の代替動線（設定アプリ遷移）を提供。

## ユーザーフロー
- シナリオ: 初回起動または権限拒否後の再訪 → 権限説明 → 「許可する」タップ → OS ダイアログ → 結果に応じてメインへ遷移またはリトライ。
- 前提: 権限未取得または拒否。
- 終了条件: 許可取得でメインへ、拒否で設定誘導/閉じる。

## レイアウト概要
- ビューポート: iPhone 15 Pro 390x844pt。
- セクション/コンポーネント:
  - ヒーロー/アイコン: 抽象的な位置/波形イメージ。
  - タイトル + リード文: 権限理由を短文で提示。
  - CTA ボタン: 「位置情報を許可」。
  - サブ CTA: 「あとで」「設定を開く」。
  - 注意書き: 背景再生と位置更新が必要な旨。
- 寸法表（目安）:

| 要素 | サイズ(pt) | 余白(pt) | 備考 |
| ---- | ----------- | -------- | ---- |
| タイトル | 24 / Semibold | 上 40 | 中央揃え |
| リード文 | 16 / Regular | 上 12 | 2–3 行まで |
| CTA ボタン | 高さ 52 | 上 32 | フル幅、角丸 12 |
| サブ CTA | 16 | 上 16 | 透明ボタン |

## コンポーネント詳細
- タイトル/リード
  - 役割: 権限が必要な理由を伝える。
  - ステート: normal。
  - AX: テキスト読み上げ。
- CTA 「位置情報を許可」
  - 役割: OS 権限ダイアログを開く。
  - ステート: enabled / disabled（OS ダイアログ表示中）。
  - 相互作用: タップ。
  - バインド: `PermissionStore.state`。
  - AX: 「位置情報を許可」ボタン。
- サブ CTA 「あとで」「設定を開く」
  - 役割: 後でにする／設定アプリを開く。
  - ステート: normal。
  - AX: それぞれのラベル。
- 注意書き
  - 役割: バックグラウンドオーディオ・位置更新が必要である旨。
  - AX: テキスト読み上げ。

## データ・状態（StateObservationKit / ステートマシン）
- ステートマシン: `PermissionStore.state`
  - 状態: awaitingConsent → requesting → granted / denied / restricted
  - 遷移トリガー: CTA タップ、OS ダイアログ結果、設定復帰。
  - 副作用: 権限 API 呼び出し、設定アプリへのディープリンク。
- 購読ストア: `PermissionStore.state`。
- ローカル状態: OS ダイアログ表示フラグ、ロードインジケータ。
- エラー/ローディング表示: `requesting` でスピナー、`denied/restricted` で警告文と「設定を開く」。
- 状態遷移表（例）:

| 現在 | イベント/条件 | 遷移先 | 副作用 |
| ---- | ------------- | ------ | ------ |
| awaitingConsent | 「位置情報を許可」タップ | requesting | OS 権限ダイアログ表示 |
| requesting | OS 許可 | granted | PermissionStore 更新、メインへ遷移 |
| requesting | OS 拒否/制限 | denied/restricted | 警告表示、設定リンク表示 |
| denied | 「設定を開く」タップ | denied | 設定アプリへディープリンク |

## アニメーション・モーション
- CTA タップ時に軽いスケールダウン (0.95)。
- 許可取得時はフェードでメインへ遷移（1s 未満）。

## サウンド挙動
- なし（オーディオ開始はメイン画面遷移後）。

## 空状態・エラー状態
- ネットワーク不要。OS 権限 API 失敗時は「再試行」文言を表示。

## 権限・デバイス前提
- 必要: 位置情報（When In Use + 背景）。Motion は PH1 では不要。
- 許可されない場合: 再生機能は利用不可、設定誘導のみ。

## 計測・ログ（任意）
- イベント: 許可 CTA タップ、OS ダイアログ結果、設定遷移。
- メトリクス: 許可率、拒否率、再訪時許可率。

## 未決事項・メモ
- 文言トーン（カジュアル/フォーマル）の最終決定。
- アイコン/イラストのスタイル（抽象的に統一）。
